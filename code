# generated by mBlock5 for HaloCode
# codes make you happy

import mbuild, time, event, halo
# initialize variables
ir_sensor = 0
Disance = 0
Speed = 0
Position = 0
speed = 0
TIme = 0
block_choice = 0

def Turn_on_off_lights ():
    global ir_sensor, Disance, Speed, Position, speed, TIme, block_choice
    """This will help the disabbled person to automatically
    turn on/off lights according to dayshift or nightshift."""
    while True:
        mbuild.led_panel.show(mbuild.light_sensor.get_value(1), wait = False, index = 1)
        if mbuild.light_sensor.get_value(1) < 20:
            mbuild.rgb_led.show(239, 239, 239, 1)

        else:
            mbuild.rgb_led.off(1)

@event.start
def on_start():
    global ir_sensor, Disance, Speed, Position, speed, TIme, block_choice
    while not halo.button.is_pressed():
        pass

    while True:
        Fever_check()
        Watering_plants()
        Check_gas_leack()
        Turn_on_off_lights()
        Kitchen_temperature()
        Track_unknown_person()
        Show_temp_and_humidity()
        Detect_movement__with_sound()
        Track_distance_of_unknown_person()

def Kitchen_temperature ():
    global ir_sensor, Disance, Speed, Position, speed, TIme, block_choice
    """This will check the temperature in the kitchen and it will adtust
    the air ventilator according to the hotness level of the kitchen."""
    if mbuild.humiture_sensor.get_temperature("celsius", 1) > 50:
        mbuild.led_panel.show('High_temp_open_ventilator', wait = True, index = 1)
        mbuild.led_panel.show(mbuild.humiture_sensor.get_temperature("celsius", 1), wait = False, index = 1)
        time.sleep(2)

    else:
        mbuild.led_panel.show('Temp ', wait = True, index = 1)
        mbuild.led_panel.show(mbuild.humiture_sensor.get_temperature("celsius", 1), wait = False, index = 1)
        time.sleep(2)

def Show_temp_and_humidity ():
    global ir_sensor, Disance, Speed, Position, speed, TIme, block_choice
    """When the button on board is pressed, the display
    will show the Temperature and Humidity of the room.
    Also, it will have the ability to control the air
    conditioner according to the temperature. (Example:
    if the temperatore of the room is high then the A.C
    will turn the temperature down to it's comfort level.)"""
    mbuild.led_panel.show_image("000c18181c0c000000000c1c18180c00", index = 1)
    while True:
        mbuild.led_panel.show('Temp ', wait = True, index = 1)
        mbuild.led_panel.show(mbuild.humiture_sensor.get_temperature("celsius", 1), wait = False, index = 1)
        time.sleep(2)
        mbuild.led_panel.show('Humidity ', wait = True, index = 1)
        mbuild.led_panel.show(mbuild.humiture_sensor.get_relative_humidity(1), wait = False, index = 1)
        time.sleep(2)
        mbuild.led_panel.show('', wait = False, index = 1)
        if mbuild.humiture_sensor.get_temperature("celsius", 1) < 25:
            mbuild.speaker.play_melody_until_done('!525', 1)

        if mbuild.humiture_sensor.get_temperature("celsius", 1) > 28:
            mbuild.speaker.play_melody_until_done('!521', 1)

def Track_unknown_person ():
    global ir_sensor, Disance, Speed, Position, speed, TIme, block_choice
    """This will check and track any unknown person sneaks
    around the house and will let the person about it."""
    mbuild.led_panel.show_image("000c18181c0c000000000c1c18180c00", index = 1)
    while True:
        mbuild.pir_sensor.reset_count(1)
        if mbuild.pir_sensor.is_activated(1):
            Human_detected()

def Watering_plants ():
    global ir_sensor, Disance, Speed, Position, speed, TIme, block_choice
    """This will measure the mooisture level of pet_plants in th ehome
    and automitomatically water it with water pump untill its done."""
    if mbuild.soil_moisture.get_humidity(1) < 15:
        mbuild.dc_motor_driver.set_power(60, 1)
        mbuild.led_panel.show('Plants is being watered', wait = True, index = 1)

    else:
        if mbuild.soil_moisture.get_humidity(1) > 80:
            mbuild.dc_motor_driver.set_power(0, 1)
            mbuild.led_panel.show('Plants has been watered', wait = True, index = 1)

        else:
            mbuild.led_panel.show('The plant is healthy and watered', wait = True, index = 1)

def Human_detected ():
    global ir_sensor, Disance, Speed, Position, speed, TIme, block_choice
    """This function wil be executed if there is some
    one roaming arounf to aware the disabbled person."""
    mbuild.led_panel.show('Person', wait = False, index = 1)
    for count in range(2):
        mbuild.speaker.play_melody('!101', 1)
        time.sleep(1)

def Fever_check ():
    global ir_sensor, Disance, Speed, Position, speed, TIme, block_choice
    """This will check the body temperature of the person, if the
    temperature is above a certain level, it will display that the
    person is having fever. So, th eperson can go and check for COVID-19"""
    while True:
        if mbuild.temp_sensor.get_temperature("fahrenheit", 1) > 90:
            mbuild.speaker.play_melody('!108', 1)
            mbuild.led_panel.show('Fever ', wait = True, index = 1)
            time.sleep(2)

        else:
            mbuild.led_panel.show(mbuild.temp_sensor.get_temperature("fahrenheit", 1), wait = False, index = 1)
            time.sleep(0.1)

def Track_distance_of_unknown_person ():
    global ir_sensor, Disance, Speed, Position, speed, TIme, block_choice
    """This will measure the distance of unknown person from the
    doo and will keep updated about it to the disabbled person.
    It will let the person know if he is too close to the door."""
    if mbuild.ultrasonic_sensor.get_distance(1) < 20:
        mbuild.led_panel.show(mbuild.ultrasonic_sensor.get_distance(1), wait = False, index = 1)
        if mbuild.ultrasonic_sensor.get_distance(1) < 7:
            Close_contact()

def Fire_in_the_kitchen_house ():
    global ir_sensor, Disance, Speed, Position, speed, TIme, block_choice
    """This will alarm the person in the house if there
    is flame/fire detected in the house or kitchen."""
    if mbuild.flame_sensor.is_active(1):
        mbuild.speaker.play_melody('!222', 1)
        mbuild.led_panel.show('fire', wait = True, index = 1)
        time.sleep(1)

def Detect_movement__with_sound ():
    global ir_sensor, Disance, Speed, Position, speed, TIme, block_choice
    """This will detect if anything or person fell
    from high or just felled on the ground."""
    while True:
        if mbuild.sound_sensor.get_loudness(1) > 50:
            mbuild.speaker.play_melody('!205', 1)
            mbuild.led_panel.show('Movement', wait = True, index = 1)
            time.sleep(0.5)

        else:
            mbuild.led_panel.clear(1)

def Check_gas_leack ():
    global ir_sensor, Disance, Speed, Position, speed, TIme, block_choice
    """This will let the person know if there is any gas leac
    in the hour=se/kitchen, if the gas leak is high or low
    it will alarm the person with sound and on the display."""
    while True:
        if mbuild.mq2_gas_sensor.is_active('high', 1):
            mbuild.speaker.play_melody('!222', 1)
            mbuild.led_panel.show('Gas_leak', wait = True, index = 1)
            time.sleep(1)

        else:
            mbuild.led_panel.show('', wait = False, index = 1)

def Close_contact ():
    global ir_sensor, Disance, Speed, Position, speed, TIme, block_choice
    """This function will let the disabled person how far is the
    unknown person is, it will execute if the person comes
     too closer."""
    for count2 in range(2):
        mbuild.speaker.play_melody('!532', 1)
        time.sleep(1)

